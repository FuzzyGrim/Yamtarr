{% load static %}

{% block content %}

<!DOCTYPE html>
<html lang="en">

  <head>
    {% include "app/include/tags.html" %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">

    <title>Yamtarr</title>
  </head>

  <body id="search">

    {% include "app/include/navbar.html" %}    

    <main>
        {% if messages %}
            {% for message in messages %}
            {% if message.tags == 'error' %}
                <div class="alert alert-danger">
            {% else %}
                <div class="alert alert-{{ message.tags }}">
            {% endif %}
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
        {% for query in query_list.results %}
            <div class="d-flex flex-column box">
                <div class="d-flex flex-row">
                    
                    {% if query.poster_path == None %}
                        <div class="image-not-found poster flex-shrink-0">
                        </div>
                    {% else %}
                        <img class="poster flex-shrink-0" src="https://image.tmdb.org/t/p/w185{{query.poster_path}}">
                    {% endif %}

                    <div class="d-flex flex-column content flex-grow-1">
                        <div class="title">
                            {{query.name}}
                            {{query.title}}
                            {% if query.first_air_date or query.release_date%}
                                ({{query.first_air_date|slice:"4"}}{{query.release_date|slice:"4"}}) 
                                {% if query.media_type == "tv"%} [TV]
                                {% elif query.media_type == "movie"%} [Movie]
                                {% endif %}
                            {% endif %}
                        </div>
                        <div class="overview">
                            {{query.overview}}
                        </div>

                        <form class="d-flex input-group" method="post">
                            {% csrf_token %}

                            {% if query.seasons and query.seasons != 1 %}
                                <select name="season" class="form-select">
                                    {% load extras %}
                                    {% for i in query.seasons|times %}
                                        <option value="{{forloop.counter}}">S{{forloop.counter}}</option>
                                    {% endfor %}
                                </select>
                            {% endif %}
                            <select name="status" class="form-select">
                                <option value="Completed">Completed</option>
                                <option value="Planning">Planning</option>
                                <option value="Watching">Watching</option>
                                <option value="Paused">Paused</option>
                                <option value="Dropped">Dropped</option>
                            </select>
                            <input type="number" class="form-control bg-dark text-white" name="score" placeholder="0" aria-label="10" maxlength="3" step="0.1" min="0" max="10">
                            
                            <!-- if tv show -->
                            {% if query.name %}
                                <input type="hidden" name="title" value="{{ query.name }}">
                                {% if query.seasons and query.seasons != 1 %}
                                    <input type="hidden" name="num_seasons" value="{{ query.seasons }}">
                                {% endif %}
                            <!-- else movie -->
                            {% else %}
                                <input type="hidden" name="title" value="{{ query.title }}">
                            {% endif %}
                            <input type="hidden" name="media_type" value="{{ query.media_type }}">
                            <input type="hidden" name="media_id" value="{{ query.id }}">
                            <input type="hidden" name="image" value="{{ query.poster_path }}">
                            
                            <button class="btn bg-dark text-white" type="submit"><i class="bi bi-check-lg"></i></button>
                        </form>
                    </div>
                </div>
            </div>

        {% endfor %}

    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>

    </body>

</html>
{% endblock %}